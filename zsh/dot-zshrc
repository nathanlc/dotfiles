# Do not enable Ctrl-s to stop I/O in terminal
stty -ixon

# Setup emacs keybindings
bindkey -e

# No need to write cd to change directory
setopt AUTO_CD
# Make globs case-insensitives
setopt NO_CASE_GLOB

# Create a history file
HISTFILE=${ZDOTDIR}/.zsh_history
# Add more info for each history entry
setopt EXTENDED_HISTORY
# Remember number of commands in session and file
SAVEHIST=500000
HISTSIZE=500000
# Share history across multiple zsh
setopt SHARE_HISTORY
# Append to history
setopt APPEND_HISTORY
# Adds commands as they are typed, not at shell exit
setopt INC_APPEND_HISTORY
# Expire duplicates first
setopt HIST_EXPIRE_DUPS_FIRST 
# Do not store duplications
setopt HIST_IGNORE_DUPS
# Ignore duplicates when searching
setopt HIST_FIND_NO_DUPS
# Removes blank lines from history
setopt HIST_REDUCE_BLANKS
# Verify command taken from history
setopt HIST_VERIFY

# Correct typos in commands
setopt CORRECT

function if_macos {
  [[ $(uname) == 'Darwin' ]] && return 0 || return 1
}

function if_def {
  command -v "$1" >/dev/null 2>&1 && return 0 || return 1
}

# Aliases START
alias c='khal calendar'
alias cs='vdirsyncer sync && khal calendar'
alias cp='cp -iv'
alias mv='mv -iv'
alias ll='ls -AlhF --color=always --group-directories-first'
alias ls='ls -AF --color=always --group-directories-first'
alias lt='ls -AlhFrt --color=always'
alias ...='cd ../..'
alias ....='cd ../../..'
alias dc='docker compose'
alias dx='docker compose exec'
alias dxw='docker compose exec web zsh -ic'
alias gb='git branch --list'
alias gc='git checkout'
alias gd='git diff'
alias gs='git status'
alias gl='git log --oneline --decorate --graph'
alias gfa='git fetch --all'
alias gwl='git worktree list'
alias gwa='git worktree add'
alias gwr='git worktree remove'
alias o='open'
alias psg='ps aux | grep --colour -i'
alias tmuxat='tmux a -t'
alias s='for i in {1..15}; do echo; done' # Create some space in the terminal
alias cl=clear
alias sail='[ -f sail ] && sh sail || sh vendor/bin/sail'
alias vc='nvim --clean'

# Completion START
autoload -Uz compinit && compinit
# Use zsh-autosuggestions
if_macos && source /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh
# Case insensitive path-completion
zstyle ':completion:*' matcher-list 'm:{[:lower:][:upper:]}={[:upper:][:lower:]}' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*' 'm:{[:lower:][:upper:]}={[:upper:][:lower:]} l:|=* r:|=*'
# Partial completion suggestions
zstyle ':completion:*' list-suffixes zstyle ':completion:*' expand prefix suffix
# Load bashcompinit for some old bash completions
autoload bashcompinit && bashcompinit
# Completion END

# Word delimiters in zsh
export WORDCHARS="${WORDCHARS/\/}"

# Java
if_def jenv && eval "$(jenv init -)"
# Starship START
export STARSHIP_CONFIG=$XDG_CONFIG_HOME/starship/starship.toml
if_def starship && eval "$(starship init zsh)"

# rust Cargo
[[ -f "$HOME/.cargo/env" ]] && . "$HOME/.cargo/env"

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
if_def atuin && eval "$(atuin init zsh)"
if_def zoxide && eval "$(zoxide init zsh)"
if_def direnv && eval "$(direnv hook zsh)"
if_def mise && eval "$(mise activate zsh)"
